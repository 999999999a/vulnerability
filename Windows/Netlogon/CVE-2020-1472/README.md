# CVE-2020-1472

## 来源

[https://github.com/SecuraBV/CVE-2020-1472](https://github.com/SecuraBV/CVE-2020-1472)

## 简介

攻击者在通过NetLogon（MS-NRPC）协议与AD域控建立安全通道时，可利用该漏洞将AD域控的计算机账号密码置为空，从而控制域控服务器。

## 影响范围

-   Windows Server, version 20H2 (Server Core Installation)
-   Windows Server 2012 R2 (Server Core installation)
-   Windows Server 2012 R2
-   Windows Server 2012 (Server Core installation)
-   Windows Server 2012
-   Windows Server 2008 R2 for x64-based Systems Service Pack 1 (Server Core installation)
-   Windows Server 2008 R2 for x64-based Systems Service Pack 1
-   Windows Server 2016 (Server Core installation)
-   Windows Server 2016
-   Windows Server, version 1903 (Server Core installation)
-   Windows Server, version 1909 (Server Core installation)
-   Windows Server 2019 (Server Core installation)
-   Windows Server 2019
-   Windows Server, version 2004 (Server Core installation)

## 漏洞类型

-   权限提升

## ZeroLogon testing script

A Python script that uses the Impacket library to test vulnerability for the Zerologon exploit (CVE-2020-1472).

It attempts to perform the Netlogon authentication bypass. The script will immediately terminate when successfully 
performing the bypass, and not perform any Netlogon operations. When a domain controller is patched, the detection 
script will give up after sending 2000 pairs of RPC calls and conclude the target is not vulnerable (with a 
false negative chance of 0.04%).

## Installation

Requires Python 3.7 or higher and Pip. Install dependencies as follows:

    pip install -r requirements.txt

Note that running `pip install impacket` should work as well, as long as the script is not broken by future Impacket 
versions.

## Running the script

The script targets can be used to target a DC or backup DC. It likely also works against a read-only DC, but this has 
not been tested. Given a domain controller named `EXAMPLE-DC` with IP address `1.2.3.4`, run the script as follows:

    ./zerologon_tester.py EXAMPLE-DC 1.2.3.4

The DC name should be its NetBIOS computer name. If this name is not correct, the script will likely fail with a 
`STATUS_INVALID_COMPUTER_NAME` error.

A Whitepaper on this vulnerability will be published here: https://www.secura.com/blog/zero-logon on Monday 14 sept. 

## Running via Docker

Instead of running the script locally, you can also run a Docker container as follows:

    sudo docker run -it ttervoort/zerologon-tester EXAMPLE-DC 1.2.3.4



