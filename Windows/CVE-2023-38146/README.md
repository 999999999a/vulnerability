# CVE-2023-38146

## 来源

[https://github.com/gabe-k/themebleed](https://github.com/gabe-k/themebleed)

## 简介

该漏洞存在于Windows题中，是一个远程代码执行漏洞。攻击者可引诱用户打开特制的主题文件，进而利用该漏洞在目标服务器上远程执行代码。

## 影响范围

-   Windows 11 Version 22H2 for x64-based Systems
-   Windows 11 Version 22H2 for ARM64-based Systems
-   Windows 11 version 21H2 for ARM64-based Systems
-   Windows 11 version 21H2 for x64-based Systems

## 漏洞类型

程序逻辑错误

## POC

Proof-of-Concept for CVE-2023-38146 ("ThemeBleed")
```
Usage: ThemeBleed.exe <command>

Commands:
        server                                   - Runs the server
        make_theme <host> <output path>          - Generates a .theme file referencing the specified host
        make_themepack <host> <output_path>      - Generates a .themepack file referencing the specified host
```

## Data files
The binaries in data correspond to the 3 files returned to the target by the PoC.
- `stage_1` - An `msstyles` file with the `PACKTHEM_VERSION` set to 999.
- `stage_2` - A valid unmodified `msstyles` file to pass the signature check.
- `stage_3` - The DLL that will be loaded and executed. The provided example simply launches `calc.exe`.

To make your own payload, create a DLL with an export named `VerifyThemeVersion` containing your code, and replace `stage_3` with your newly created DLL.
