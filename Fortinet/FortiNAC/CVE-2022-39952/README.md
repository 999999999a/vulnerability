# CVE-2022-39952
POC for CVE-2022-39952 affecting Fortinet FortiNAC

The default configuration of this exploit writes a cron job to create a
reverse shell. Be sure to change the `payload` file to suite your environment.

## 来源

[https://github.com/horizon3ai/CVE-2022-39952](https://github.com/horizon3ai/CVE-2022-39952)

## 影响范围

-   FortiNAC 版本 9.4.0
-   FortiNAC 版本 9.2.0 到 9.2.5
-   FortiNAC 版本 9.1.0 到 9.1.7
-   FortiNAC 8.8 所有版本
-   FortiNAC 8.7 所有版本
-   FortiNAC 8.6 所有版本
-   FortiNAC 8.5 所有版本
-   FortiNAC 8.3 所有版本

## 简介

FortiNAC 是一个网络[访问控制](https://so.csdn.net/so/search?q=访问控制&spm=1001.2101.3001.7020)解决方案，帮助组织机构获得实时网络可见性、执行安全策略并检测和缓解威胁。

Fortinet FortiNAC 版本 9.4.0、9.2.0 至 9.2.5、9.1.0 至 9.1.7、8.8.0 至 8.8.11、8.7.0 至 8.7.6、8.6 中的文件名或路径的外部控制。 0 到 8.6.5、8.5.0 到 8.5.4、8.3.7 可能允许未经身份验证的攻击者通过特制的 HTTP 请求执行未经授权的代码或命令。

这是一个影响 Fortinet 网络访问控制解决方案 FortiNAC 的严重漏洞,滥用 keyUpload.jsp 端点来实现任意文件写入。

## Technical Analysis
A technical root cause analysis of the vulnerability and indicators of compromise can be found on our blog:
https://www.horizon3.ai/fortinet-fortinac-cve-2022-39952-deep-dive-and-iocs

## Summary
This POC abuses the keyUpload.jsp endpoint to achieve an arbitrary file write.

## Usage
```plaintext
root@kali:~/CVE-2022-39952# python3 CVE-2022-39952.py --target 10.0.40.85 --file payload
[+] Wrote payload to /etc/cron.d/payload
[+] Payload successfully delivered
```

## Troubleshooting
If using a cron based payload, make sure the payload file has the appropriate
permissions and owner:
```shell
sudo chown root:root payload
```
```shell
sudo chmod 0644 payload 
```

## Mitigations
Update to the latest version by following the instructions within the PSIRT
https://www.fortiguard.com/psirt/FG-IR-22-300

## Follow the Horizon3.ai Attack Team on Twitter for the latest security research:
*  [Horizon3 Attack Team](https://twitter.com/Horizon3Attack)
*  [James Horseman](https://twitter.com/JamesHorseman2)
*  [Zach Hanley](https://twitter.com/hacks_zach)

## Disclaimer
This software has been created purely for the purposes of academic research and for the development of effective defensive techniques, and is not intended to be used to attack systems except where explicitly authorized. Project maintainers are not responsible or liable for misuse of the software. Use responsibly.

